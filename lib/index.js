// Generated by CoffeeScript 1.7.1
var app;

app = angular.module('cachedResource', ['ngResource']);

app.service('cacheResource', [
  '$resource', '$timeout', '$q', function($resource, $timeout, $q) {
    var localStorageKey;
    if (window.localStorage == null) {
      return (function(identity) {
        return identity;
      });
    }
    localStorageKey = function(url, parameters) {
      var name, value;
      for (name in parameters) {
        value = parameters[name];
        url = url.replace(":" + name, value);
      }
      return url;
    };
    return function(url) {
      var CachedResource, Resource;
      Resource = $resource.apply(null, arguments);
      CachedResource = {};
      if (Resource.get != null) {
        CachedResource.get = function(parameters) {
          var instance, key;
          if (typeof parameters === 'function') {
            parameters = null;
          }
          key = localStorageKey(url, parameters);
          instance = Resource.get.apply(Resource, arguments);
          instance.$promise.then(function(response) {
            return localStorage.setItem(key, angular.toJson(response));
          });
          return angular.extend(instance, angular.fromJson(localStorage.getItem(key)));
        };
      }
      return CachedResource;
    };
  }
]);

app;
